<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>Ø¯Ø±Ø®ÙˆØ§Ø³Øª ÛŒØ¯Ú©â€ŒÚ©Ø´ / Ù…Ú©Ø§Ù†ÛŒÚ© Ø³ÛŒØ§Ø±</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@30.1.0/dist/font-face.css" rel="stylesheet" type="text/css" />
<style>
/* Reset Ùˆ Ù¾Ø§ÛŒÙ‡ */
* { box-sizing: border-box; margin:0; padding:0; }
body {
  font-family: 'Vazir', Tahoma, sans-serif;
  background: linear-gradient(135deg, #f8f9fa, #e9ecef);
  display: flex;
  justify-content: center;
  align-items: flex-start;
  min-height: 100vh;
  padding: 40px 10px;
}

/* ÙØ±Ù… */
form {
  width: 100%;
  max-width: 480px;
  background: #fff;
  padding: 30px 25px;
  border-radius: 20px;
  box-shadow: 0 12px 25px rgba(0,0,0,0.12);
  transition: transform 0.3s, box-shadow 0.3s;
}
form:hover { 
  transform: translateY(-5px); 
  box-shadow: 0 20px 40px rgba(0,0,0,0.15);
}

h3 {
  text-align: center;
  margin-bottom: 25px;
  color: #343a40;
  font-size: 1.7em;
  letter-spacing: 0.5px;
}

/* ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ */
input, select, textarea, button {
  width: 100%;
  margin-top: 12px;
  padding: 14px 12px;
  border-radius: 10px;
  border: 1px solid #ced4da;
  font-size: 1em;
  transition: border 0.3s, box-shadow 0.3s;
}
input:focus, select:focus, textarea:focus {
  border-color: #20c997;
  box-shadow: 0 0 8px rgba(32,199,151,0.3);
  outline: none;
}
select { appearance: none; cursor: pointer; }
textarea { resize: vertical; min-height: 90px; }

/* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ */
button {
  border: none;
  cursor: pointer;
  font-weight: bold;
  margin-top: 12px;
  transition: all 0.3s;
}
button.loc { 
  background: #0d6efd; 
  color: #fff; 
}
button.loc:hover { background: #0b5ed7; }
button.submit { 
  background: #20c997; 
  color: #fff; 
}
button.submit:hover { background: #1ca885; }

/* Ù†Ù‚Ø´Ù‡ */
#map {
  height: 320px;
  margin-top: 15px;
  display: none;
  border-radius: 10px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

/* Ù…ÙˆØ¨Ø§ÛŒÙ„ */
@media(max-width:500px){
  form { padding: 25px 15px; }
}
</style>
</head>
<body>

<form id="form">
  <h3>Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø®Ø¯Ù…Ø§Øª</h3>

  <select name="service" required>
    <option value="">Ù†ÙˆØ¹ Ø®Ø¯Ù…Ø§Øª</option>
    <option value="ÛŒØ¯Ú©â€ŒÚ©Ø´">ÛŒØ¯Ú©â€ŒÚ©Ø´</option>
    <option value="Ù…Ú©Ø§Ù†ÛŒÚ© Ø³ÛŒØ§Ø±">Ù…Ú©Ø§Ù†ÛŒÚ© Ø³ÛŒØ§Ø±</option>
  </select>

  <input name="name" placeholder="Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ" required>
  <input name="phone" placeholder="Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³" required>
  <input name="plate" placeholder="Ø´Ù…Ø§Ø±Ù‡ Ù¾Ù„Ø§Ú© Ø®ÙˆØ¯Ø±Ùˆ" required>
  <textarea name="desc" placeholder="ØªÙˆØ¶ÛŒØ­ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)"></textarea>

  <input type="hidden" name="lat" id="lat">
  <input type="hidden" name="lon" id="lon">

  <button type="button" class="loc" onclick="showMap()">ğŸ“ Ø§Ù†ØªØ®Ø§Ø¨ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡</button>
  <div id="map"></div>

  <button type="submit" class="submit">Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª</button>
</form>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
let map, marker;

function showMap(){
  const mapDiv = document.getElementById("map");
  mapDiv.style.display = "block";

  if(!map){
    map = L.map('map').setView([35.7, 51.4], 13); // Ù…Ø±Ú©Ø² ØªÙ‡Ø±Ø§Ù†

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    map.on('click', function(e){
      const {lat, lng} = e.latlng;

      if(marker) map.removeLayer(marker);
      marker = L.marker([lat,lng]).addTo(map);

      document.getElementById("lat").value = lat.toFixed(6);
      document.getElementById("lon").value = lng.toFixed(6);
    });
  }
}

document.getElementById("form").onsubmit = async e => {
  e.preventDefault();
  const data = Object.fromEntries(new FormData(e.target));

  if(!data.lat || !data.lon){
    alert("Ù„Ø·ÙØ§Ù‹ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø®ÙˆØ¯ Ø±Ø§ Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ ğŸ“");
    return;
  }

  try {
    const res = await fetch("/api/submit",{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify(data)
    });
    const result = await res.json();
    if(result.status === "ok") {
      alert("Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯ âœ…");
      e.target.reset();
      document.getElementById("map").style.display = "none";
      if(marker) marker.remove();
    } else {
      alert("Ø®Ø·Ø§: " + result.message);
    }
  } catch(err) {
    alert("Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡: " + err.message);
  }
};
</script>

</body>
</html>
