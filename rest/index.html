
<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>Ø¯Ø±Ø®ÙˆØ§Ø³Øª ÛŒØ¯Ú©â€ŒÚ©Ø´ / Ù…Ú©Ø§Ù†ÛŒÚ© Ø³ÛŒØ§Ø±</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family:tahoma; background:#f2f2f2; }
form { max-width:420px; margin:30px auto; background:#fff; padding:20px; border-radius:10px; }
input, select, textarea, button { width:100%; margin-top:10px; padding:10px; }
button { background:#28a745; color:#fff; border:none; cursor:pointer; }
#mapContainer { display:none; position:fixed; top:0; left:0; width:100%; height:100%; z-index:1000; background:#fff; }
#map { width:100%; height:80%; }
.map-buttons { display:flex; justify-content:space-around; margin:10px 0; }
.map-buttons button { flex:1; margin:0 5px; padding:10px; border:none; border-radius:5px; cursor:pointer; color:#fff; }
.map-buttons .manual { background:#007bff; }
.map-buttons .current { background:#ffc107; color:#000; }
.map-buttons .close { background:#dc3545; }
</style>
</head>
<body>

<form id="form">
  <h3>Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø®Ø¯Ù…Ø§Øª</h3>

  <select name="service" required>
    <option value="">Ù†ÙˆØ¹ Ø®Ø¯Ù…Ø§Øª</option>
    <option value="ÛŒØ¯Ú©â€ŒÚ©Ø´">ÛŒØ¯Ú©â€ŒÚ©Ø´</option>
    <option value="Ù…Ú©Ø§Ù†ÛŒÚ© Ø³ÛŒØ§Ø±">Ù…Ú©Ø§Ù†ÛŒÚ© Ø³ÛŒØ§Ø±</option>
  </select>

  <input name="name" placeholder="Ù†Ø§Ù…" required>
  <input name="phone" placeholder="Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³" required>
  <input name="plate" placeholder="Ø´Ù…Ø§Ø±Ù‡ Ù¾Ù„Ø§Ú©" required>
  <textarea name="desc" placeholder="ØªÙˆØ¶ÛŒØ­ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)"></textarea>

  <input type="hidden" name="lat" id="lat">
  <input type="hidden" name="lon" id="lon">

  <button type="button" onclick="openMap()">ğŸ“ Ø§Ù†ØªØ®Ø§Ø¨ Ù…ÙˆÙ‚Ø¹ÛŒØª</button>
  <button type="submit">Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª</button>
</form>

<!-- Ú©Ø§Ù†ØªÛŒÙ†Ø± Ù†Ù‚Ø´Ù‡ -->
<div id="mapContainer">
  <div class="map-buttons">
    <button class="manual" onclick="enableManual()">ğŸ–±ï¸ Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø³ØªÛŒ</button>
    <button class="current" onclick="useCurrentLocation()">ğŸ“Œ Ù…ÙˆÙ‚Ø¹ÛŒØª ÙØ¹Ù„ÛŒ</button>
    <button class="close" onclick="closeMap()">âœ– Ø¨Ø³ØªÙ† Ù†Ù‚Ø´Ù‡</button>
  </div>
  <div id="map"></div>
</div>

<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY"></script>
<script>
let map, marker;
let manualMode = false;

// Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù†Ù‚Ø´Ù‡
function openMap() {
  document.getElementById('mapContainer').style.display = 'block';
  if (!map) {
    map = new google.maps.Map(document.getElementById('map'), {
      center: { lat: 35.6892, lng: 51.3890 },
      zoom: 12
    });
  }
}

// Ø¨Ø³ØªÙ† Ù†Ù‚Ø´Ù‡
function closeMap() {
  document.getElementById('mapContainer').style.display = 'none';
}

// ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø­Ø§Ù„Øª Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø³ØªÛŒ
function enableManual() {
  manualMode = true;
  alert('Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ ØªØ§ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø§Ù†ØªØ®Ø§Ø¨ Ø´ÙˆØ¯.');
}

// Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù…ÙˆÙ‚Ø¹ÛŒØª
google.maps.event.addListener(document, 'click', function(){});
if (google.maps) {
  google.maps.event.addListener(window, 'load', function(){});
}

function initMapClick() {
  map.addListener('click', (event) => {
    if (!manualMode) return;

    const position = event.latLng;
    if (marker) marker.setMap(null);
    marker = new google.maps.Marker({ position, map });

    document.getElementById('lat').value = position.lat();
    document.getElementById('lon').value = position.lng();

    manualMode = false; // Ø¨Ø¹Ø¯ Ø§Ø² Ø§Ù†ØªØ®Ø§Ø¨ ÛŒÚ© Ø¨Ø§Ø±
    alert('Ù…ÙˆÙ‚Ø¹ÛŒØª Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯.');
  });
}

// Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù…ÙˆÙ‚Ø¹ÛŒØª ÙØ¹Ù„ÛŒ
function useCurrentLocation() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition((position) => {
      const pos = { lat: position.coords.latitude, lng: position.coords.longitude };

      document.getElementById('lat').value = pos.lat;
      document.getElementById('lon').value = pos.lng;

      map.setCenter(pos);
      map.setZoom(15);

      if (marker) marker.setMap(null);
      marker = new google.maps.Marker({ position: pos, map: map });
    }, () => { alert('Ø§Ù…Ú©Ø§Ù† Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª Ø´Ù…Ø§ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.'); });
  } else {
    alert('Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ø§Ø² Geolocation Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯.');
  }
}

// Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡ Ø¨Ø¹Ø¯ Ø§Ø² load
window.onload = () => {
  if (map) initMapClick();
  else setTimeout(initMapClick, 1000);
};
</script>

</body>
</html>

