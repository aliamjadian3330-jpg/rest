<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>Ø¯Ø±Ø®ÙˆØ§Ø³Øª ÛŒØ¯Ú©â€ŒÚ©Ø´ / Ù…Ú©Ø§Ù†ÛŒÚ© Ø³ÛŒØ§Ø±</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<style>
body {
  font-family: Tahoma, sans-serif;
  background: linear-gradient(to bottom, #e0f7fa, #ffffff);
  margin: 0;
  padding: 0;
}
form {
  max-width: 450px;
  margin: 50px auto;
  background: #fff;
  padding: 30px 25px;
  border-radius: 15px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.15);
}
form h3 { text-align: center; margin-bottom: 25px; color: #007bff; font-size: 1.6em; }
input, select, textarea, button { width: 100%; margin-top: 12px; padding: 12px 15px; font-size: 1em; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; transition: all 0.3s ease; }
button { cursor: pointer; font-weight: bold; }
button[type="submit"] { background: #28a745; color: #fff; border: none; margin-top: 20px; }
button[type="submit"]:hover { background: #218838; }
button.loc { background: #007bff; color: #fff; }
button.loc:hover { background: #0069d9; }
textarea { resize: vertical; min-height: 80px; }
#mapModal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; justify-content:center; align-items:center; }
#mapContainer { width:90%; max-width:500px; height:400px; border-radius:10px; overflow:hidden; }
@media (max-width: 500px) { form { margin: 30px 15px; padding: 25px 20px; } }
</style>
</head>
<body>

<form id="form">
  <h3>Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø®Ø¯Ù…Ø§Øª</h3>
  <select name="service" required>
    <option value="">Ù†ÙˆØ¹ Ø®Ø¯Ù…Ø§Øª</option>
    <option value="ÛŒØ¯Ú©â€ŒÚ©Ø´">ÛŒØ¯Ú©â€ŒÚ©Ø´</option>
    <option value="Ù…Ú©Ø§Ù†ÛŒÚ© Ø³ÛŒØ§Ø±">Ù…Ú©Ø§Ù†ÛŒÚ© Ø³ÛŒØ§Ø±</option>
  </select>
  <input name="name" placeholder="Ù†Ø§Ù…" required>
  <input name="phone" placeholder="Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³" required>
  <input name="plate" placeholder="Ø´Ù…Ø§Ø±Ù‡ Ù¾Ù„Ø§Ú©" required>
  <textarea name="desc" placeholder="ØªÙˆØ¶ÛŒØ­ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)"></textarea>

  <input type="hidden" name="lat" id="lat">
  <input type="hidden" name="lon" id="lon">

  <button type="button" class="loc" onclick="openMap()">ğŸ“ Ø§Ù†ØªØ®Ø§Ø¨ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡</button>
  <button type="submit">Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª</button>
</form>

<div id="mapModal">
  <div id="mapContainer"></div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
let map, marker;

function openMap() {
  document.getElementById('mapModal').style.display = 'flex';

  if(!map) {
    map = L.map('mapContainer').setView([35.6892, 51.3890], 13); // Ù…Ø±Ú©Ø² ØªÙ‡Ø±Ø§Ù†
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
    }).addTo(map);

    map.on('click', function(e) {
      const {lat, lng} = e.latlng;
      if(marker) map.removeLayer(marker);
      marker = L.marker([lat,lng]).addTo(map);
      document.getElementById('lat').value = lat;
      document.getElementById('lon').value = lng;
      alert(`Ù…ÙˆÙ‚Ø¹ÛŒØª Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯ âœ…\nLatitude: ${lat}\nLongitude: ${lng}`);
      document.getElementById('mapModal').style.display = 'none';
    });
  }
}

document.getElementById("form").onsubmit = async e => {
  e.preventDefault();
  const data = Object.fromEntries(new FormData(e.target));
  const res = await fetch("/api/submit",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify(data)
  });
  alert("Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø«Ø¨Øª Ø´Ø¯ âœ…");
};
</script>

</body>
</html>
